##############################################################################
#
# This file contains the Apache directives for making the jacs server 
# side file store accessible to remote clients via WebDAV.
#
# Details on the key directives can be found at:
#   http://httpd.apache.org/docs/current/mod/directives.html
#
# To simplify automated client mapping,
# alias paths use the following convention:
#   /WebDAV/<root server path>
#
# There is also a convenience /jacsData alias defined to simplify
# manually created connections.
#
# All directories (with the exception of upload) should limit
# access to read only operations (GET, OPTIONS, PROPFIND).
#
# The upload alias allows only write operations, preventing read
# operations so that one client is not allowed to see the contents
# of another clients uploaded files.
#
#              ******** PLEASE NOTE ********
#
# IF YOU CHANGE THIS FILE, please make sure the changes are committed
# to the jacs source code repository (under buildprocess/apache).
#
##############################################################################

# Make sure to list this more specific upload alias
# before the the less specific jacsData alias!
Alias /WebDAV/nobackup/jacs/jacsData/filestore/upload "/nobackup/jacs/jacsData/filestore/upload"
<Directory "/nobackup/jacs/jacsData/filestore/upload">

  Dav On
  DavDepthInfinity on
  Options +Indexes

  # only allow writes (PUT for files, MKCOL for directories)
  # to the upload directory

  <Limit PUT MKCOL OPTIONS PROPFIND>
    AuthType Basic
    AuthName "/nobackup/jacs/jacsData/filestore/upload"
    AuthBasicProvider ldap
    AuthzLDAPAuthoritative off
    AuthLDAPGroupAttribute memberUid
    AuthLDAPGroupAttributeIsDN off
    AuthLDAPURL "ldap://ldap-vip1.int.janelia.org/dc=hhmi,dc=org"
    Require ldap-group cn=jacsdata,ou=Groups,dc=hhmi,dc=org

    Order Deny,Allow
    Deny from all
    Allow from all
  </Limit>

  <LimitExcept PUT MKCOL OPTIONS PROPFIND>
    Order Allow,Deny
    Allow from all
    Deny from all
  </LimitExcept>

</Directory>

Alias /WebDAV/nobackup/jacs/jacsData "/nobackup/jacs/jacsData"
<Directory "/nobackup/jacs/jacsData">

  Dav On
  DavDepthInfinity on
  Options +Indexes

  <Limit GET OPTIONS PROPFIND>
    AuthType Basic
    AuthName "/nobackup/jacs/jacsData"
    AuthBasicProvider ldap
    AuthzLDAPAuthoritative off
    AuthLDAPGroupAttribute memberUid
    AuthLDAPGroupAttributeIsDN off
    AuthLDAPURL "ldap://ldap-vip1.int.janelia.org/dc=hhmi,dc=org"
    Require ldap-group cn=jacsdata,ou=Groups,dc=hhmi,dc=org

    Order Deny,Allow
    Deny from all
    Allow from all
  </Limit>

  <LimitExcept GET OPTIONS PROPFIND>
    Order Allow,Deny
    Allow from all
    Deny from all
  </LimitExcept>

</Directory>

Alias /WebDAV/groups/scicomp/jacsData "/groups/scicomp/jacsData"
Alias /jacsData "/groups/scicomp/jacsData"
<Directory "/groups/scicomp/jacsData">

  Dav On
  DavDepthInfinity on
  Options +Indexes

  <Limit GET OPTIONS PROPFIND>
    AuthType Basic
    AuthName "/groups/scicomp/jacsData"
    AuthBasicProvider ldap
    AuthzLDAPAuthoritative off
    AuthLDAPGroupAttribute memberUid
    AuthLDAPGroupAttributeIsDN off
    AuthLDAPURL "ldap://ldap-vip1.int.janelia.org/dc=hhmi,dc=org"
    Require ldap-group cn=jacsdata,ou=Groups,dc=hhmi,dc=org

    Order Deny,Allow
    Deny from all
    Allow from all
  </Limit>

  <LimitExcept GET OPTIONS PROPFIND>
    Order Allow,Deny
    Allow from all
    Deny from all
  </LimitExcept>

</Directory>

Alias /WebDAV/groups/jacs/jacsShare "/groups/jacs/jacsShare"
Alias /jacsShare "/groups/jacs/jacsShare"
<Directory "/groups/jacs/jacsShare">

  Dav On
  DavDepthInfinity on
  Options +Indexes

  <Limit GET OPTIONS PROPFIND>
    AuthType Basic
    AuthName "/groups/jacs/jacsShare"
    AuthBasicProvider ldap
    AuthzLDAPAuthoritative off
    AuthLDAPGroupAttribute memberUid
    AuthLDAPGroupAttributeIsDN off
    AuthLDAPURL "ldap://ldap-vip1.int.janelia.org/dc=hhmi,dc=org"
    Require ldap-group cn=jacsdata,ou=Groups,dc=hhmi,dc=org

    Order Deny,Allow
    Deny from all
    Allow from all
  </Limit>

  <LimitExcept GET OPTIONS PROPFIND>
    Order Allow,Deny
    Allow from all
    Deny from all
  </LimitExcept>

</Directory>

Alias /WebDAV/tier2/flylight/flip "/tier2/flylight/flip"
<Directory "/tier2/flylight/flip">

  Dav On
  DavDepthInfinity on
  Options +Indexes

  <Limit GET OPTIONS PROPFIND>
    AuthType Basic
    AuthName "/tier2/flylight/flip"
    AuthBasicProvider ldap
    AuthzLDAPAuthoritative off
    AuthLDAPGroupAttribute memberUid
    AuthLDAPGroupAttributeIsDN off
    AuthLDAPURL "ldap://ldap-vip1.int.janelia.org/dc=hhmi,dc=org"
    Require ldap-group cn=flylightconf,ou=Groups,dc=hhmi,dc=org

    Order Deny,Allow
    Deny from all
    Allow from all
  </Limit>

  <LimitExcept GET OPTIONS PROPFIND>
    Order Allow,Deny
    Allow from all
    Deny from all
  </LimitExcept>

</Directory>

Alias /WebDAV/tier2/flylight/polarity "/tier2/flylight/polarity"
<Directory "/tier2/flylight/polarity">

  Dav On
  DavDepthInfinity on
  Options +Indexes

  <Limit GET OPTIONS PROPFIND>
    AuthType Basic
    AuthName "/tier2/flylight/polarity"
    AuthBasicProvider ldap
    AuthzLDAPAuthoritative off
    AuthLDAPGroupAttribute memberUid
    AuthLDAPGroupAttributeIsDN off
    AuthLDAPURL "ldap://ldap-vip1.int.janelia.org/dc=hhmi,dc=org"
    Require ldap-group cn=flylightconf,ou=Groups,dc=hhmi,dc=org

    Order Deny,Allow
    Deny from all
    Allow from all
  </Limit>

  <LimitExcept GET OPTIONS PROPFIND>
    Order Allow,Deny
    Allow from all
    Deny from all
  </LimitExcept>

</Directory>

Alias /WebDAV/tier2/flylight/ssplit "/tier2/flylight/ssplit"
<Directory "/tier2/flylight/ssplit">

  Dav On
  DavDepthInfinity on
  Options +Indexes

  <Limit GET OPTIONS PROPFIND>
    AuthType Basic
    AuthName "/tier2/flylight/ssplit"
    AuthBasicProvider ldap
    AuthzLDAPAuthoritative off
    AuthLDAPGroupAttribute memberUid
    AuthLDAPGroupAttributeIsDN off
    AuthLDAPURL "ldap://ldap-vip1.int.janelia.org/dc=hhmi,dc=org"
    Require ldap-group cn=flylightconf,ou=Groups,dc=hhmi,dc=org

    Order Deny,Allow
    Deny from all
    Allow from all
  </Limit>

  <LimitExcept GET OPTIONS PROPFIND>
    Order Allow,Deny
    Allow from all
    Deny from all
  </LimitExcept>

</Directory>

Alias /WebDAV/tier2/leet/leetimg/leetlab/lineage "/tier2/leet/leetimg/leetlab/lineage"
<Directory "/tier2/leet/leetimg/leetlab/lineage">

  Dav On
  DavDepthInfinity on
  Options +Indexes

  <Limit GET OPTIONS PROPFIND>
    AuthType Basic
    AuthName "/tier2/leet/leetimg/leetlab/lineage"
    AuthBasicProvider ldap
    AuthzLDAPAuthoritative off
    AuthLDAPGroupAttribute memberUid
    AuthLDAPGroupAttributeIsDN off
    AuthLDAPURL "ldap://ldap-vip1.int.janelia.org/dc=hhmi,dc=org"
    Require ldap-group cn=leetimg,ou=Groups,dc=hhmi,dc=org

    Order Deny,Allow
    Deny from all
    Allow from all
  </Limit>

  <LimitExcept GET OPTIONS PROPFIND>
    Order Allow,Deny
    Allow from all
    Deny from all
  </LimitExcept>

</Directory>

Alias /WebDAV/tier2/mousebrainmicro "/tier2/mousebrainmicro"
  <Directory "/tier2/mousebrainmicro">

  Dav On
  DavDepthInfinity on
  Options +Indexes

  <Limit GET OPTIONS PROPFIND>
    AuthType Basic
    AuthName "/tier2/mousebrainmicro"
    AuthBasicProvider ldap
    AuthzLDAPAuthoritative off
    AuthLDAPGroupAttribute memberUid
    AuthLDAPGroupAttributeIsDN off
    AuthLDAPURL "ldap://ldap-vip1.int.janelia.org/dc=hhmi,dc=org"
    Require ldap-group cn=mousebrainmicro,ou=Groups,dc=hhmi,dc=org

    Order Deny,Allow
    Deny from all
    Allow from all
  </Limit>

  <LimitExcept GET OPTIONS PROPFIND>
    Order Allow,Deny
    Allow from all
    Deny from all
  </LimitExcept>

</Directory>

Alias /WebDAV/groups/flylight/flylight/dickson "/groups/flylight/flylight/dickson"
<Directory "/groups/flylight/flylight/dickson">

  Dav On
  DavDepthInfinity on
  Options +Indexes

  <Limit GET OPTIONS PROPFIND>
    AuthType Basic
    AuthName "/groups/flylight/flylight/dickson"
    AuthBasicProvider ldap
    AuthzLDAPAuthoritative off
    AuthLDAPGroupAttribute memberUid
    AuthLDAPGroupAttributeIsDN off
    AuthLDAPURL "ldap://ldap-vip1.int.janelia.org/dc=hhmi,dc=org"
    Require ldap-group cn=flylightconf,ou=Groups,dc=hhmi,dc=org

    Order Deny,Allow
    Deny from all
    Allow from all
  </Limit>

  <LimitExcept GET OPTIONS PROPFIND>
    Order Allow,Deny
    Allow from all
    Deny from all
  </LimitExcept>

</Directory>

Alias /WebDAV/groups/ditp/ditp/confocalStacks "/groups/ditp/ditp/confocalStacks"
<Directory "/groups/ditp/ditp/confocalStacks">

  Dav On
  DavDepthInfinity on
  Options +Indexes

  <Limit GET OPTIONS PROPFIND>
    AuthType Basic
    AuthName "/groups/ditp/ditp/confocalStacks"
    AuthBasicProvider ldap
    AuthzLDAPAuthoritative off
    AuthLDAPGroupAttribute memberUid
    AuthLDAPGroupAttributeIsDN off
    AuthLDAPURL "ldap://ldap-vip1.int.janelia.org/dc=hhmi,dc=org"
    Require ldap-group cn=ditp,ou=Groups,dc=hhmi,dc=org

    Order Deny,Allow
    Deny from all
    Allow from all
  </Limit>

  <LimitExcept GET OPTIONS PROPFIND>
    Order Allow,Deny
    Allow from all
    Deny from all
  </LimitExcept>

</Directory>

Alias /WebDAV/groups/jacs/jacsDev "/groups/jacs/jacsDev"
<Directory "/groups/jacs/jacsDev">

  Dav On
  DavDepthInfinity on
  Options +Indexes

  <Limit GET OPTIONS PROPFIND>
    AuthType Basic
    AuthName "/groups/jacs/jacsDev"
    AuthBasicProvider ldap
    AuthzLDAPAuthoritative off
    AuthLDAPGroupAttribute memberUid
    AuthLDAPGroupAttributeIsDN off
    AuthLDAPURL "ldap://ldap-vip1.int.janelia.org/dc=hhmi,dc=org"
    Require ldap-group cn=jacsdata,ou=Groups,dc=hhmi,dc=org

    Order Deny,Allow
    Deny from all
    Allow from all
  </Limit>

  <LimitExcept GET OPTIONS PROPFIND>
    Order Allow,Deny
    Allow from all
    Deny from all
  </LimitExcept>

</Directory>

##############################################################################
#
# The following aliases are set-up for testing purposes and utilize
# a limited 'testuser' account whose credentials can be safely 
# included in test code.  The credentials were created by the htpasswd
# utility and are stored in /opt/jacs-webdav-test/auth/.htpasswd
#
##############################################################################

Alias /WebDAV/opt/jacs-webdav-test/test-read "/opt/jacs-webdav-test/test-read"
<Directory "/opt/jacs-webdav-test/test-read">

  Dav On
  DavDepthInfinity on
  Options +Indexes

  <Limit GET OPTIONS PROPFIND>
    AuthType Basic
    AuthName "/opt/jacs-webdav-test/test-read"
    AuthUserFile /opt/jacs-webdav-test/auth/.htpasswd
    Require valid-user

    Order Deny,Allow
    Deny from all
    Allow from all
  </Limit>

  <LimitExcept GET OPTIONS PROPFIND>
    Order Allow,Deny
    Allow from all
    Deny from all
  </LimitExcept>

</Directory>

Alias /WebDAV/opt/jacs-webdav-test/test-write "/opt/jacs-webdav-test/test-write"
<Directory "/opt/jacs-webdav-test/test-write">
     
  Dav On      
  DavDepthInfinity on
  Options +Indexes
     
  # only allow writes to this test directory

  <Limit PUT MKCOL OPTIONS PROPFIND>
    AuthType Basic
    AuthName "/opt/jacs-webdav-test/test-write"
    AuthUserFile /opt/jacs-webdav-test/auth/.htpasswd
    Require valid-user
    
    Order Deny,Allow
    Deny from all
    Allow from all
  </Limit>    
    
  <LimitExcept PUT MKCOL OPTIONS PROPFIND>
    Order Allow,Deny
    Allow from all
    Deny from all
  </LimitExcept>
    
</Directory>
