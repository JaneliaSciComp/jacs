##############################################################################
#
# This file contains the Apache directives for making the jacs server 
# side file store accessible to remote clients via WebDAV.
#
# Details on the key directives can be found at:
#   http://httpd.apache.org/docs/current/mod/directives.html
#
# To simplify automated client mapping,
# alias paths use the following convention:
#   /WebDAV/<root server path>
#
# There is also a convenience /jacsData alias defined to simplify
# manually created connections.
#
# All directories (with the exception of upload) should limit
# access to read only operations (GET, OPTIONS, PROPFIND).
#
# The upload alias allows only write operations, preventing read
# operations so that one client is not allowed to see the contents
# of another clients uploaded files.
#
#              ******** PLEASE NOTE ********
#
# IF YOU CHANGE THIS FILE, please make sure the changes are committed
# to the jacs source code repository (under buildprocess/apache).
#
##############################################################################

# Make sure to list this more specific upload alias 
# before the the less specific jacsData alias!
Alias /WebDAV/groups/scicomp/jacsData/upload "/groups/scicomp/jacsData/upload"
<Directory "/groups/scicomp/jacsData/upload">

  Dav On      
  DavDepthInfinity on
  Options +Indexes
     
  # only allow writes (PUT for files, MKCOL for directories)
  # to the upload directory

  <Limit PUT MKCOL OPTIONS PROPFIND>
    AuthType Basic
    AuthName "/groups/scicomp/jacsData/upload"
    AuthBasicProvider ldap
    AuthzLDAPAuthoritative off
    AuthLDAPGroupAttribute memberUid
    AuthLDAPGroupAttributeIsDN off
    AuthLDAPURL "ldap://ldap.int.janelia.org/dc=janelia,dc=org"
    Require ldap-group cn=jacsdata,ou=Groups,dc=janelia,dc=org
    
    Order Deny,Allow
    Deny from all
    Allow from all
  </Limit>    
    
  <LimitExcept PUT MKCOL OPTIONS PROPFIND>
    Order Allow,Deny
    Allow from all
    Deny from all
  </LimitExcept>
    
</Directory>

Alias /WebDAV/groups/scicomp/jacsData "/groups/scicomp/jacsData"
Alias /jacsData "/groups/scicomp/jacsData"
<Directory "/groups/scicomp/jacsData">

  Dav On
  DavDepthInfinity on
  Options +Indexes

  <Limit GET OPTIONS PROPFIND>
    AuthType Basic
    AuthName "/groups/scicomp/jacsData"
    AuthBasicProvider ldap
    AuthzLDAPAuthoritative off
    AuthLDAPGroupAttribute memberUid
    AuthLDAPGroupAttributeIsDN off
    AuthLDAPURL "ldap://ldap.int.janelia.org/dc=janelia,dc=org"
    Require ldap-group cn=jacsdata,ou=Groups,dc=janelia,dc=org

    Order Deny,Allow
    Deny from all
    Allow from all
  </Limit>

  <LimitExcept GET OPTIONS PROPFIND>
    Order Allow,Deny
    Allow from all
    Deny from all
  </LimitExcept>

</Directory>

Alias /WebDAV/archive/scicomp/jacsData "/archive/scicomp/jacsData"
<Directory "/archive/scicomp/jacsData">

  Dav On
  DavDepthInfinity on
  Options +Indexes

  <Limit GET OPTIONS PROPFIND>
    AuthType Basic
    AuthName "/archive/scicomp/jacsData"
    AuthBasicProvider ldap
    AuthzLDAPAuthoritative off
    AuthLDAPGroupAttribute memberUid
    AuthLDAPGroupAttributeIsDN off
    AuthLDAPURL "ldap://ldap.int.janelia.org/dc=janelia,dc=org"
    Require ldap-group cn=jacsdata,ou=Groups,dc=janelia,dc=org

    Order Deny,Allow
    Deny from all
    Allow from all
  </Limit>

  <LimitExcept GET OPTIONS PROPFIND>
    Order Allow,Deny
    Allow from all
    Deny from all
  </LimitExcept>

</Directory>

Alias /WebDAV/groups/flylight/flylight/flip "/groups/flylight/flylight/flip"
<Directory "/groups/flylight/flylight/flip">

  Dav On
  DavDepthInfinity on
  Options +Indexes

  <Limit GET OPTIONS PROPFIND>
    AuthType Basic
    AuthName "/groups/flylight/flylight/flip"
    AuthBasicProvider ldap
    AuthzLDAPAuthoritative off
    AuthLDAPGroupAttribute memberUid
    AuthLDAPGroupAttributeIsDN off
    AuthLDAPURL "ldap://ldap.int.janelia.org/dc=janelia,dc=org"
    Require ldap-group cn=flylightconf,ou=Groups,dc=janelia,dc=org

    Order Deny,Allow
    Deny from all
    Allow from all
  </Limit>

  <LimitExcept GET OPTIONS PROPFIND>
    Order Allow,Deny
    Allow from all
    Deny from all
  </LimitExcept>

</Directory>

Alias /WebDAV/groups/flylight/flylight/polarity "/groups/flylight/flylight/polarity"
<Directory "/groups/flylight/flylight/polarity">

  Dav On
  DavDepthInfinity on
  Options +Indexes

  <Limit GET OPTIONS PROPFIND>
    AuthType Basic
    AuthName "/groups/flylight/flylight/polarity"
    AuthBasicProvider ldap
    AuthzLDAPAuthoritative off
    AuthLDAPGroupAttribute memberUid
    AuthLDAPGroupAttributeIsDN off
    AuthLDAPURL "ldap://ldap.int.janelia.org/dc=janelia,dc=org"
    Require ldap-group cn=flylightconf,ou=Groups,dc=janelia,dc=org

    Order Deny,Allow
    Deny from all
    Allow from all
  </Limit>

  <LimitExcept GET OPTIONS PROPFIND>
    Order Allow,Deny
    Allow from all
    Deny from all
  </LimitExcept>

</Directory>

Alias /WebDAV/groups/ditp/ditp/confocalStacks "/groups/ditp/ditp/confocalStacks"
<Directory "/groups/ditp/ditp/confocalStacks">

  Dav On
  DavDepthInfinity on
  Options +Indexes

  <Limit GET OPTIONS PROPFIND>
    AuthType Basic
    AuthName "/groups/ditp/ditp/confocalStacks"
    AuthBasicProvider ldap
    AuthzLDAPAuthoritative off
    AuthLDAPGroupAttribute memberUid
    AuthLDAPGroupAttributeIsDN off
    AuthLDAPURL "ldap://ldap.int.janelia.org/dc=janelia,dc=org"
    Require ldap-group cn=ditp,ou=Groups,dc=janelia,dc=org

    Order Deny,Allow
    Deny from all
    Allow from all
  </Limit>

  <LimitExcept GET OPTIONS PROPFIND>
    Order Allow,Deny
    Allow from all
    Deny from all
  </LimitExcept>

</Directory>

##############################################################################
#
# The following aliases are set-up for testing purposes and utilize
# a limited 'testuser' account whose credentials can be safely 
# included in test code.  The credentials were created by the htpasswd
# utility and are stored in /opt/jacs-webdav-test-auth/.htpasswd 
#
##############################################################################

Alias /WebDAV/opt/jacs-webdav-test "/opt/jacs-webdav-test"
<Directory "/opt/jacs-webdav-test">

  Dav On
  DavDepthInfinity on
  Options +Indexes

  <Limit GET OPTIONS PROPFIND>
    AuthType Basic
    AuthName "/opt/jacs-webdav-test"
    AuthUserFile /opt/jacs-webdav-test-auth/.htpasswd
    Require valid-user

    Order Deny,Allow
    Deny from all
    Allow from all
  </Limit>

  <LimitExcept GET OPTIONS PROPFIND>
    Order Allow,Deny
    Allow from all
    Deny from all
  </LimitExcept>

</Directory>

Alias /WebDAV/opt/jacs-webdav-write-test "/opt/jacs-webdav-write-test"
<Directory "/opt/jacs-webdav-write-test">
     
  Dav On      
  DavDepthInfinity on
  Options +Indexes
     
  # only allow writes to this test directory

  <Limit PUT MKCOL OPTIONS PROPFIND>
    AuthType Basic
    AuthName "/opt/jacs-webdav-write-test"
    AuthUserFile /opt/jacs-webdav-test-auth/.htpasswd
    Require valid-user
    
    Order Deny,Allow
    Deny from all
    Allow from all
  </Limit>    
    
  <LimitExcept PUT MKCOL OPTIONS PROPFIND>
    Order Allow,Deny
    Allow from all
    Deny from all
  </LimitExcept>
    
</Directory>
