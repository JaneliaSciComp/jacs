<?xml version="1.0"?>
<!--
  ~ Copyright (c) 2010-2011, J. Craig Venter Institute, Inc.
  ~
  ~ This file is part of JCVI VICS.
  ~
  ~ JCVI VICS is free software; you can redistribute it and/or modify it
  ~ under the terms and conditions of the Artistic License 2.0.  For
  ~ details, see the full text of the license in the file LICENSE.txt.  No
  ~ other rights are granted.  Any and all third party software rights to
  ~ remain with the original developer.
  ~
  ~ JCVI VICS is distributed in the hope that it will be useful in
  ~ bioinformatics applications, but it is provided "AS IS" and WITHOUT
  ~ ANY EXPRESS OR IMPLIED WARRANTIES including but not limited to
  ~ implied warranties of merchantability or fitness for any particular
  ~ purpose.  For details, see the full text of the license in the file
  ~ LICENSE.txt.
  ~
  ~ You should have received a copy of the Artistic License 2.0 along with
  ~ JCVI VICS.  If not, the license can be obtained from
  ~ "http://www.perlfoundation.org/artistic_license_2_0."
  -->

<project name="build-module-init">

    <target name="setup" depends="set-common-properties, set-conditions" unless="build.dir">
    </target>

	<!-- Sets properties (duh). Can be overriden or extended by each module -->
	<target name="set-common-properties">
		<!-- Directories common to all modules -->
		<property name="build.dir" value="${basedir}/build"/>
		<property name="build.classes.dir" value="${build.dir}/classes"/>
		<property name="build.jars.dir" value="${build.dir}/jars"/>
		<property name="lib.dir" value="${basedir}/lib"/>
		<property name="src.dir" value="${basedir}/src"/>
		<property name="conf.dir" value="${basedir}/conf"/>
        <property name="common.dir" value="${basedir}/../common"/>

		<!-- unit test stuff -->
		<property name="build.test.classes.dir" value="${build.dir}/test/classes"/>
		<property name="test.src.dir" value="${basedir}/test"/>
        <property name="test.resources.dir" value="${test.src.dir}/resources"/>
		<property name="test.reports.dir" value="${build.dir}/test/reports"/>

		<!-- Common compilation settings -->
		<property name="compile.classpath" value=" "/>
		<property name="compile.debug" value="on"/>
		<property name="compile.optimize" value="off"/>
		<property name="compile.deprecation" value="on"/>

        <!-- References to other modules -->
        <property name="common.module" value="${basedir}/../common" />
        <property name="model.module" value="${basedir}/../model" />
        <property name="shared.module" value="${basedir}/../shared" />
        <property name="compute.module" value="${basedir}/../compute" />

        <path id="compile.classpath.jaxb">
            <fileset dir="${common.module}/JAXB-2.1.5/" includes="*.jar"/>
        </path>
        <path id="compile.ant.libs">
            <fileset dir="${basedir}/../buildprocess/lib/" includes="*.jar"/>
        </path>

        <!-- default directory for jacs.properties -->
        <property name="jacs.properties.dir" value="${shared.module}/conf" />
        
        <taskdef name="xjc" classname="com.sun.tools.xjc.XJCTask">
            <classpath refid="compile.classpath.jaxb"/>
        </taskdef>

        <!--<taskdef resource="net/sf/antcontrib/antcontrib.properties">-->
          <!--<classpath>-->
            <!--<pathelement location="${lib.dir}/ant-contrib-0.3.jar"/>-->
          <!--</classpath>-->
        <!--</taskdef>-->

        <taskdef resource="com/orangevolt/tools/ant/taskdefs.properties">
            <classpath refid="compile.ant.libs"/>
        </taskdef>

    </target>

    <macrodef name="echo-directory-condition">
        <attribute name="directoryPropertyName"/>
        <sequential>
            <echo message="${ant.project.name} module @{directoryPropertyName} is ${@{directoryPropertyName}} (exists = ${@{directoryPropertyName}.exists})" />
        </sequential>
    </macrodef>

    <!-- Sets properties noting whether some resources exist -->
    <target name="set-conditions">
        <available property="lib.dir.exists"          value="true" file="${lib.dir}"      type="dir"/>
        <available property="src.dir.exists"          value="true" file="${src.dir}"      type="dir"/>
        <available property="test.src.dir.exists"     value="true" file="${test.src.dir}" type="dir"/>
        <available property="build.dir.exists"        value="true" file="${build.dir}"    type="dir"/>
        <available property="test.reports.dir.exists" value="true" file="${test.reports.dir}" type="dir"/>

        <!-- uncomment for debug -->
        <!--<echo-directory-condition directoryPropertyName="lib.dir" />-->
        <!--<echo-directory-condition directoryPropertyName="src.dir" />-->
        <!--<echo-directory-condition directoryPropertyName="test.src.dir" />-->
        <!--<echo-directory-condition directoryPropertyName="build.dir" />-->
        <!--<echo-directory-condition directoryPropertyName="test.reports.dir" />-->

    </target>

</project>
