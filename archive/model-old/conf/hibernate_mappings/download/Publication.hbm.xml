<?xml version="1.0" encoding="UTF-8"?>

<!--
  ~ Copyright (c) 2010-2011, J. Craig Venter Institute, Inc.
  ~
  ~ This file is part of JCVI VICS.
  ~
  ~ JCVI VICS is free software; you can redistribute it and/or modify it
  ~ under the terms and conditions of the Artistic License 2.0.  For
  ~ details, see the full text of the license in the file LICENSE.txt.  No
  ~ other rights are granted.  Any and all third party software rights to
  ~ remain with the original developer.
  ~
  ~ JCVI VICS is distributed in the hope that it will be useful in
  ~ bioinformatics applications, but it is provided "AS IS" and WITHOUT
  ~ ANY EXPRESS OR IMPLIED WARRANTIES including but not limited to
  ~ implied warranties of merchantability or fitness for any particular
  ~ purpose.  For details, see the full text of the license in the file
  ~ LICENSE.txt.
  ~
  ~ You should have received a copy of the Artistic License 2.0 along with
  ~ JCVI VICS.  If not, the license can be obtained from
  ~ "http://www.perlfoundation.org/artistic_license_2_0."
  -->

<!DOCTYPE hibernate-mapping PUBLIC
    "-//Hibernate/Hibernate Mapping DTD 3.0//EN"
    "http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd">

<hibernate-mapping package="org.janelia.it.jacs.model.download"
                   default-access="property"
                   default-lazy="false"
                   auto-import="true"
                   default-cascade="none"
                  >
    <class name="Publication"
           table="publication"
           mutable="true"
           dynamic-update="true"
           dynamic-insert="true"
           select-before-update="false"
           polymorphism="implicit"
          >

        <id name="objectId"
            type="java.lang.Long"
            access="field"
            column="oid"
           >
            <generator class="org.janelia.it.jacs.model.TimebasedIdentifierGenerator" />
        </id>

        <property name="publicationAccession" type="string" length="50" unique="true" column="publication_acc" />
        <property name="abstractOfPublication" type="string" length="15000" />
        <property name="summary" type="string" length="15000"/>
        <property name="title" type="string" length="1000" />
        <!-- URL string to let user get the subject document. -->
        <property name="subjectDocument" type="string" length="3000" />
        <property name="supplementalText" column="supplemental_text" type="string" length="3000" />
        <property name="pubDate" column="pub_date" type="date" />
        <property name="journalEntry" column="journal_entry" type="string" />

        <list name="authors"
              table="publication_author_link"
              cascade="all"
              lazy="false"
              optimistic-lock="false">

            <key column="publication_id"/>
            <index column="position"/>
            <!-- one author may work on many pub's and one pub be authored by many people. -->
            <many-to-many class="Author" column="author_id" />

        </list>

        <property name="description" type="string" >
            <column name="description_html" sql-type="text"/>
        </property>

        <!-- Link to combined archives.  Sometimes, there will be archives containing all data
             that is represented in the whole hierarchy.  And when so, there will be one file
             in .gz and one in .tar format. -->
        <list name="rolledUpArchives"
              table="publication_combined_archives_link"
              cascade="all-delete-orphan"
              lazy="false"
              optimistic-lock="false">

            <key column="publication_id" />
            <index column="position" />
            <many-to-many class="DataFile" column="data_file_id" />

        </list>

        <list name="hierarchyRootNodes"
              table="publication_hierarchy_node_link"
              cascade="all-delete-orphan"
              lazy="false"
              optimistic-lock="false">

            <key column="publication_id"/>
            <index column="position" />
            <!-- One publication may refer to many hierarchies, and v-v -->
            <many-to-many class="HierarchyNode" column="hierarchy_node_id" />

        </list>

        <bag name="projects"
            table="project_publication_link"
              lazy="true" inverse="true" cascade="none">
            <key column="publication_id"/>
            <many-to-many class="Project" column="project_id" />
        </bag>

    </class>
</hibernate-mapping>