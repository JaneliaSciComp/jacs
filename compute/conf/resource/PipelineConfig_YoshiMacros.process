<process name="Yoshi Fiji Macros Pipeline" processor="queue/samplePipelineLauncher" startEvent="pending">
	<sequence>
	    
	    <input name="PIPELINE_PROCESS"/>
        <input name="CHANNEL_DYE_SPEC_20X"/>
        <input name="OUTPUT_CHANNEL_ORDER_20X"/>
	    <input name="CHANNEL_DYE_SPEC_63X"/>
        <input name="OUTPUT_CHANNEL_ORDER_63X"/>
        <input name="MACRO_NAME_20x"/>
        <input name="MACRO_NAME_63x"/>
        <input name="OUTPUT_COLOR_SPEC_63x"/>
        <input name="RERUN_PIPELINES"/>
        
        <!-- Import variables from the task -->
        <operation name="Import Variables" processor="org.janelia.it.jacs.compute.service.common.InitVariablesFromTaskService">
            <input name="OVERRIDE" value="false"/>
            <input name="TASK_PARAMETER_1" value="sample entity id"/>
            <input name="PROCESS_VARIABLE_1" value="SAMPLE_ENTITY_ID"/>
            <input name="TASK_PARAMETER_2" value="rerun pipelines"/>
            <input name="PROCESS_VARIABLE_2" value="RERUN_PIPELINES"/>
            <output name="SAMPLE_ENTITY_ID"/>
            <output name="RERUN_PIPELINES"/>
        </operation>
        
        <!-- By default, rerun all pipelines -->
        <operation name="Init Variables" processor="org.janelia.it.jacs.compute.service.common.InitVariablesService">
            <input name="RERUN_PIPELINES"/>
            <input name="OVERRIDE" value="false"/>
            <input name="PROCESS_VARIABLE_1" value="RERUN_PIPELINES"/>
            <input name="PROCESS_VARIABLE_VALUE_1" value="true"/>
            <output name="RERUN_PIPELINES"/>
        </operation>
        
        <!-- Get sub-samples -->
        <operation name="Get Sub-Samples" processor="org.janelia.it.jacs.compute.service.entity.sample.GetObjectiveSamplesService">
            <input name="SAMPLE_ENTITY_ID"/>
            <input name="RERUN_PIPELINES"/>
            <input name="PIPELINES_TO_RUN_20X" value="$V{PIPELINE_PROCESS}"/>
            <input name="PIPELINES_TO_RUN_63X" value="$V{PIPELINE_PROCESS}"/>
            <output name="PARENT_SAMPLE_ID"/>
            <output name="SAMPLE_20X_ID"/>
            <output name="SAMPLE_63X_ID"/>
        </operation>
	       
        <sequence if="SAMPLE_20X_ID is not null">

            <include name="20x Pipeline" process="PipelineConfig_YoshiMacro20x">
                <input name="PIPELINE_PROCESS"/>
                <input name="MACRO_NAME" value="$V{MACRO_NAME_20x}"/>
                <input name="SAMPLE_ENTITY_ID" value="$V{SAMPLE_20X_ID}"/>
                <input name="CHANNEL_DYE_SPEC" value="$V{CHANNEL_DYE_SPEC_20X}"/>
                <input name="OUTPUT_CHANNEL_ORDER" value="$V{OUTPUT_CHANNEL_ORDER_20X}"/>
            </include>
        
        </sequence>
		
        <sequence if="SAMPLE_63X_ID is not null">
            
            <include name="63x Pipeline" process="PipelineConfig_YoshiMacro63x">
                <input name="PIPELINE_PROCESS"/>
                <input name="MACRO_NAME" value="$V{MACRO_NAME_63x}"/>
                <input name="SAMPLE_ENTITY_ID" value="$V{SAMPLE_63X_ID}"/>
                <input name="CHANNEL_DYE_SPEC" value="$V{CHANNEL_DYE_SPEC_63X}"/>
                <input name="OUTPUT_CHANNEL_ORDER" value="$V{OUTPUT_CHANNEL_ORDER_63X}"/>
                <input name="OUTPUT_COLOR_SPEC" value="$V{OUTPUT_COLOR_SPEC_63x}"/>
            </include>
            
        </sequence>
        
    </sequence>
</process>