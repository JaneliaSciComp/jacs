<!-- 
	Synchronize index with entities in the database. 
-->
<process name="Neuron Merge Process" processor="java:/jms/queue/consolePipelineLauncher" startEvent="pending" updateProcessStatus="on_success" >

    <sequence name="Neuron Merge" waitForAsync="true">
    
        <operation name="Import Variables" processor="org.janelia.it.jacs.compute.service.common.InitVariablesFromTaskService">
            <input name="TASK_PARAMETER_1" value="separationEntityId"/>
            <input name="PROCESS_VARIABLE_1" value="ROOT_ENTITY_ID"/>
            <output name="ROOT_ENTITY_ID"/>
        </operation>
        
        <operation name="Create Neuron Merge Result Node" processor="org.janelia.it.jacs.compute.service.vaa3d.CreateNeuronMergeResultFileNodeService">
            <output name="RESULT_FILE_NODE_ID"/>
            <output name="RESULT_FILE_NODE"/>
        </operation>
        
        <sequence name="Neuron Merge Grid" waitForAsync="true">
            <operation name="Neuron Merge" processor="java:/jms/queue/gridSubmitAndWait">
                <input name="iservice" value="org.janelia.it.jacs.compute.service.vaa3d.Vaa3DNeuronMergeService"/>
                <input name="RESULT_FILE_NODE_ID"/>
                <input name="RESULT_FILE_NODE"/>
                <output name="RESULT_FILE_NODE_ID"/>
                <output name="RESULT_FILE_NODE"/>
            </operation>
        </sequence>
        
        <!-- Load the merge results into the database -->
        <operation name="Neuron Merge Results" processor="org.janelia.it.jacs.compute.service.vaa3d.Vaa3DNeuronMergeResultsDiscoveryService">
            <input name="ROOT_FILE_NODE" value="$V{RESULT_FILE_NODE}"/>
            <input name="ROOT_ENTITY_ID"/>
            <input name="RESULT_ENTITY_TYPE" value="Curated Neuron"/>
            <input name="RESULT_ENTITY_NAME" value=""/>
        </operation>
        
    </sequence>
    
</process>