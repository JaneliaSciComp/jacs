<!--
	Create a guide for the specified Mask directory
-->
<process name="Mask Guide Setup" processor="queue/maskSampleAnnotationPipelineLauncher" startEvent="pending">
    <sequence name="Mask Guide" waitForAsync="true">
	    <operation name="Mask Guide" processor="queue/gridSubmitAndWait">
		    <input name="iservice" value="org.janelia.it.jacs.compute.service.fly.MaskGuideService"/>
		    <input name="MODE" value="MODE_SETUP"/>
		    <output name="MIPS_CONVERSION_PATH"/>
		    <output name="IMAGE_CONVERSION_RESULT_NODE_MAP"/>
		</operation>
	</sequence>
	<sequence forEach="MIPS_CONVERSION_PATH" waitForAsync="true">
        <sequence async="true">
            <sequence name="MIP Conversion to PNG" waitForAsync="true">
                <operation name="MIP Conversion to PNG" processor="queue/gridSubmitAndWait">
               	    <input name="iservice" value="org.janelia.it.jacs.compute.service.utility.ImageConversionService"/>
               		<input name="IMAGE_CONVERSION_RESULT_NODE_MAP"/>
               		<input name="MIPS_CONVERSION_PATH"/>
               		<input name="ALTERNATE_WORKING_DIR_PATH" value="$V{MIPS_CONVERSION_PATH}"/>
           			<input name="INPUT_FILENAME_REGEX" value="((.*?)MIP)\.tif$"/>
                	<input name="OUTPUT_FILENAME_PATTERN" value="$1.png"/>
                </operation>
            </sequence>
        </sequence>
    </sequence>
   <sequence>
        <operation name="Mask Guide Completion" processor="org.janelia.it.jacs.compute.service.fly.MaskGuideService">
		    <input name="MODE" value="MODE_COMPLETE"/>
		</operation>
	</sequence>
</process>