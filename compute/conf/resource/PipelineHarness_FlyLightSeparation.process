<process name="FlyLight Separation Task Harness" processor="queue/analysisPipelineLauncher" startEvent="pending">
	<sequence>
	    
	    <!-- Import variables from the task -->
	    <operation name="Import Variables" processor="org.janelia.it.jacs.compute.service.common.InitVariablesFromTaskService">
            <input name="TASK_PARAMETER_1" value="result entity id"/>
            <input name="PROCESS_VARIABLE_1" value="RESULT_ENTITY_ID"/>
	        <output name="RESULT_ENTITY_ID"/>
	    </operation>
	
	    <!-- Find the Sample that this result is part of -->
	    <operation name="Get Sample" processor="org.janelia.it.jacs.compute.service.entity.GetAncestorIdService">
			<input name="ENTITY_ID" value="$V{RESULT_ENTITY_ID}"/>
		    <input name="OUTPUT_VAR_NAME" value="SAMPLE_ENTITY_ID"/>
			<output name="SAMPLE_ENTITY_ID"/>
		</operation>
		
	    <!-- Read from the Entity model and export the data into parameters that will be used by the subsequent services -->
	    <operation name="Get Result Attributes" processor="org.janelia.it.jacs.compute.service.entity.sample.InitResultAttributesService">
			<input name="RESULT_ENTITY_ID"/>
			<output name="SIGNAL_CHANNELS"/>
			<output name="REFERENCE_CHANNEL"/>
            <output name="OPTICAL_RESOLUTION"/>
            <output name="PIXEL_RESOLUTION"/>
		</operation>
	
        <sequence if="REFERENCE_CHANNEL is null">
                
            <!-- Read from the Entity model and export the data into parameters that will be used by the subsequent services -->
            <operation name="Get Sample Attributes" processor="org.janelia.it.jacs.compute.service.entity.sample.InitSampleAttributesService">
                <input name="SAMPLE_ENTITY_ID"/>
                <output name="SIGNAL_CHANNELS"/>
                <output name="REFERENCE_CHANNEL"/>
            </operation>
        
        </sequence>
        
	    <!-- Decide what pipeline to run -->
	    <operation name="Get Parameters" processor="org.janelia.it.jacs.compute.service.entity.sample.InitAnalysisParametersService">
			<input name="ANALYSIS_ALGORITHM" value="NEURON_SEPARATOR"/>
			<input name="RESULT_ENTITY_ID"/>
			<output name="OUTPUT_FILENAME"/>
		</operation>
					
        <include name="Pipeline" process="FlyLightSeparationPipeline">
			<input name="ROOT_ENTITY_ID" value="$V{RESULT_ENTITY_ID}"/>
			<input name="SAMPLE_ENTITY_ID"/>
			<input name="INPUT_FILENAME" value="$V{OUTPUT_FILENAME}"/>
			<input name="RESULT_ENTITY_NAME" value="Neuron Separation"/>
			<input name="SIGNAL_CHANNELS"/>
			<input name="REFERENCE_CHANNEL"/>
            <input name="OPTICAL_RESOLUTION"/>
            <input name="PIXEL_RESOLUTION"/>
        </include>
		
    </sequence>
</process>