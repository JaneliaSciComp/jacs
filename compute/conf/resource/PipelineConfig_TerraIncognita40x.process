<process name="Terra Incognita Whole Brain Pipeline" processor="queue/samplePipelineLauncher" startEvent="pending" updateProcessStatus="on_success">
	<sequence>

        <!-- Import variables from the task -->
        <operation name="Import Variables" processor="org.janelia.it.jacs.compute.service.common.InitVariablesFromTaskService">
            <input name="OVERRIDE" value="false"/>
            <input name="SAMPLE_ENTITY_ID"/>
            <input name="REUSE_PIPELINE_RUNS"/>
            <input name="TASK_PARAMETER_1" value="sample entity id"/>
            <input name="PROCESS_VARIABLE_1" value="SAMPLE_ENTITY_ID"/>
            <input name="TASK_PARAMETER_2" value="reuse pipeline runs"/>
            <input name="PROCESS_VARIABLE_2" value="REUSE_PIPELINE_RUNS"/>
            <output name="SAMPLE_ENTITY_ID"/>
            <output name="REUSE_PIPELINE_RUNS"/>
        </operation>

        <!-- Get sub-samples -->
        <operation name="Get Sub-Samples" processor="org.janelia.it.jacs.compute.service.entity.sample.GetObjectiveSamplesService">
            <input name="SAMPLE_ENTITY_ID"/>
            <input name="REUSE_PIPELINE_RUNS"/>
            <output name="PARENT_SAMPLE_ID"/>
            <output name="SAMPLE_40X_ID"/>
            <output name="SAMPLE_63X_ID"/>
        </operation>

        <sequence if="SAMPLE_40X_ID is not null">

            <include name="Pipeline" process="FlyLightSamplePipeline">
                <input name="SAMPLE_ENTITY_ID" value="$V{SAMPLE_40X_ID}"/>
                <input name="PIPELINE_NAME" value="FlyLight Pipeline"/>
                <input name="MERGE_ALGORITHMS" value="FLYLIGHT"/>
                <input name="STITCH_ALGORITHMS" value="FLYLIGHT"/>
                <input name="ALIGNMENT_ALGORITHMS" value=""/>
                <input name="ANALYSIS_ALGORITHMS" value=""/>
                <input name="PIPELINE_PROCESS" value="FlyLightUnaligned"/>
            </include>

        </sequence>

        <sequence if="SAMPLE_63X_ID is not null">

            <include name="Pipeline" process="FlyLightSamplePipeline">
                <input name="SAMPLE_ENTITY_ID" value="$V{SAMPLE_63X_ID}"/>
                <input name="PIPELINE_NAME" value="FlyLight Pipeline"/>
                <input name="MERGE_ALGORITHMS" value="FLYLIGHT"/>
                <input name="STITCH_ALGORITHMS" value="FLYLIGHT"/>
                <input name="ALIGNMENT_ALGORITHMS" value=""/>
                <input name="ANALYSIS_ALGORITHMS" value=""/>
                <input name="PIPELINE_PROCESS" value="FlyLightUnaligned"/>
            </include>

        </sequence>

    </sequence>
</process>