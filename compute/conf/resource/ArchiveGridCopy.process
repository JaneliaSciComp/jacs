<!-- 
	Use to the grid to copy any number of files to or from the archive.
-->
<process name="Archive grid copy" processor="queue/gridArchiveAccess" startEvent="pending" updateProcessStatus="on_success">
    <sequence>
	   
        <input name="SOURCE_FILE_PATHS"/>
    	<input name="TARGET_FILE_PATHS"/>
        <input name="DELETE_SOURCE_FILES"/>
	   
	    <!-- Import variables from the task -->
	    <operation name="Import Variables" processor="org.janelia.it.jacs.compute.service.common.InitVariablesFromTaskService">
    	    <input name="OVERRIDE" value="false"/>
            <input name="SOURCE_FILE_PATHS"/>
            <input name="TARGET_FILE_PATHS"/>
            <input name="TASK_PARAMETER_1" value="source file paths"/>
            <input name="PROCESS_VARIABLE_1" value="SOURCE_FILE_PATHS"/>
            <input name="TASK_PARAMETER_2" value="target file paths"/>
            <input name="PROCESS_VARIABLE_2" value="TARGET_FILE_PATHS"/>
	        <output name="SOURCE_FILE_PATHS"/>
	        <output name="TARGET_FILE_PATHS"/>
	    </operation>

        <!-- Create a result node -->
        <operation name="Create Temp Result Node" processor="org.janelia.it.jacs.compute.service.entity.CreateNamedResultFileNodeService">
            <input name="NAME" value="Temp"/>
            <input name="OUTPUT_VAR_NAME" value="TEMP_FILE_NODE"/>
            <output name="TEMP_FILE_NODE"/>
            <output name="TEMP_FILE_NODE_ID"/>
        </operation>
        
        <!-- Copy the files to or from archive -->
        <sequence name="Wait Async" waitForAsync="true">
            <operation name="Copy files" processor="queue/gridSubmitAndWait">
                <input name="iservice" value="org.janelia.it.jacs.compute.service.utility.ArchiveGridService"/>
                <input name="RESULT_FILE_NODE"/>
                <input name="SOURCE_FILE_PATHS"/>
                <input name="TARGET_FILE_PATHS"/>
                <input name="DELETE_SOURCE_FILES"/>
            </operation>
        </sequence>
        
        <!-- We're done with the node -->
        <operation name="Remove Temp Result Node" processor="org.janelia.it.jacs.compute.service.entity.TrashFileNodeService">
            <input name="FILE_NODE_ID" value="$V{TEMP_FILE_NODE_ID}"/>
        </operation>
        
    </sequence>
</process>