<!-- 
	Add all completed samples to a special view. 
-->
<process name="Sample View Creation" processor="queue/mcfoDataPipelineLauncher" startEvent="pending" updateProcessStatus="on_success">
	<sequence>
	
	    <!-- Import variables from the EntityViewCreationTask -->
	    <operation name="Import Variables" processor="org.janelia.it.jacs.compute.service.common.InitVariablesFromTaskService">
            <input name="TASK_PARAMETER_1" value="source entity id"/>
            <input name="PROCESS_VARIABLE_1" value="TOP_LEVEL_ENTITY_ID"/>
            <input name="TASK_PARAMETER_2" value="target entity name"/>
            <input name="PROCESS_VARIABLE_2" value="VIEW_ENTITY_NAME"/>
	        <output name="TOP_LEVEL_ENTITY_ID"/>
	        <output name="ROOT_ENTITY_NAME"/>
	    </operation>
	    
	    <!-- Find all the completed Sample Entities in the database -->
		<operation name="Find Completed Samples" processor="org.janelia.it.jacs.compute.service.entity.EntityTreeTraversalService">
			<input name="ENTITY_FILTER_CLASS" value="org.janelia.it.jacs.compute.service.entity.CompleteSampleEntityFilter"/>
			<input name="ENTITY_TYPE_NAME" value="Sample"/>
			<input name="TOP_LEVEL_ENTITY_ID"/>
			<input name="ROOT_ENTITY_ID" value="$V{TOP_LEVEL_ENTITY_ID}"/>
			<input name="OUTVAR_ENTITY" value="COMPLETE_SAMPLE_LIST"/>
		</operation>
		
	    <!-- Create or update the Sample-centric view -->
		<operation name="Update the Sample View" processor="org.janelia.it.jacs.compute.service.entity.MCFOViewCreationService">
			<input name="VIEW_ENTITY_NAME"/>
			<input name="COMPLETE_SAMPLE_LIST"/>
			<input name="ENTITY_LIST" value="$V{COMPLETE_SAMPLE_LIST}"/>
		</operation>
		
    </sequence>
</process>