<process name="FlyLight Cell Counting Pipeline" processor="queue/samplePipelineLauncher" startEvent="pending">
    <sequence>

        <input name="PIPELINE_PROCESS"/>
        <input name="CHANNEL_DYE_SPEC_63X"/>
        <input name="OUTPUT_CHANNEL_ORDER_63X"/>

        <!-- Import variables from the task -->
        <operation name="Import Variables" processor="org.janelia.it.jacs.compute.service.common.InitVariablesFromTaskService">
            <input name="SAMPLE_ENTITY_ID"/>
            <input name="REUSE_PIPELINE_RUNS"/>
            <input name="TASK_PARAMETER_MAP">
                <entry key="sample entity id" value="SAMPLE_ENTITY_ID"/>
                <entry key="reuse pipeline runs" value="REUSE_PIPELINE_RUNS"/>
            </input>
            <output name="SAMPLE_ENTITY_ID"/>
            <output name="REUSE_PIPELINE_RUNS"/>
        </operation>

        <!-- Get sub-samples -->
        <operation name="Get Sub-Samples" processor="org.janelia.it.jacs.compute.service.entity.sample.GetObjectiveSamplesService">
            <input name="SAMPLE_ENTITY_ID"/>
            <input name="REUSE_PIPELINE_RUNS"/>
            <output name="PARENT_SAMPLE_ID"/>
            <output name="SAMPLE_20X_ID"/>
            <output name="SAMPLE_63X_ID"/>
        </operation>

        <sequence if="SAMPLE_20X_ID is not null">
            <include name="20x Pipeline" process="SubSampleCellCounting">
                <input name="SAMPLE_ENTITY_ID" value="$V{SAMPLE_20X_ID}"/>
                <input name="OBJECTIVE" value="20x"/>
                <input name="PIPELINE_NAME" value="Cell Counting 20x"/>
                <input name="PIPELINE_PROCESS"/>
                <input name="RUN_CELL_COUNTING" value="no"/>
                <input name="PIPELINE_PROCESS"/>
            </include>

        </sequence>

        <sequence if="SAMPLE_63X_ID is not null">

            <include name="63x Pipeline" process="SubSampleCellCounting">
                <input name="SAMPLE_ENTITY_ID" value="$V{SAMPLE_63X_ID}"/>
                <input name="OBJECTIVE" value="63x"/>
                <input name="PIPELINE_NAME" value="Cell Counting 63x"/>
                <input name="PIPELINE_PROCESS"/>
                <input name="CHANNEL_DYE_SPEC" value="$V{CHANNEL_DYE_SPEC_63X}"/>
                <input name="OUTPUT_CHANNEL_ORDER" value="$V{OUTPUT_CHANNEL_ORDER_63X}"/>
                <input name="RUN_CELL_COUNTING" value="yes"/>
                <input name="PIPELINE_PROCESS"/>
            </include>

        </sequence>

    </sequence>
</process>