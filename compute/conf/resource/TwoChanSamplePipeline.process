 <!-- 
      Create a dummy sample file from the two-signal-channel LSM and run neuron separation.
 -->
 <process name="Two Channel Sample Pipeline" processor="queue/mcfoSamplePipelineLauncher" startEvent="pending">
	<sequence>
	    
	    <!-- Import variables from the MCFOSamplePipelineTask -->
	    <operation name="Import Variables" processor="org.janelia.it.jacs.compute.service.common.InitVariablesFromTaskService">
            <input name="TASK_PARAMETER_1" value="sample entity id"/>
            <input name="PROCESS_VARIABLE_1" value="SAMPLE_ENTITY_ID"/>
	        <output name="SAMPLE_ENTITY_ID"/>
	    </operation>

	    <!-- Create a result node for this group -->
	    <operation name="Create Result Nodes" processor="org.janelia.it.jacs.compute.service.entity.CreateNamedResultFileNodeService">
		    <input name="NAME" value="Temp"/>
	        <output name="RESULT_FILE_NODE"/>
	        <output name="RESULT_FILE_NODE_ID"/>
	    </operation>

	    <!-- Choose input file -->
	    <operation name="Choose the LSM file to run on" processor="org.janelia.it.jacs.compute.service.entity.InitTwoChannelSampleService">
		    <input name="RESULT_FILE_NODE"/>
			<input name="SAMPLE_ENTITY_ID"/>
			<output name="MERGED_FILE"/>
			<output name="SAMPLE_FILE"/>
		</operation>
	    
	    <!-- Convert LSM files -->
        <sequence name="Channel conversion" waitForAsync="true">
		    <operation name="MIP Generation" processor="queue/gridSubmitAndWait">
		        <input name="iservice" value="org.janelia.it.jacs.compute.service.vaa3d.MapChannelService"/>
	    		<input name="RESULT_FILE_NODE"/>
	    		<input name="OUTPUT_FILE_NODE" value="$V{RESULT_FILE_NODE}"/>
	    		<input name="MERGED_FILE"/>
				<input name="INPUT_PATH_1" value="$V{MERGED_FILE}"/>
				<input name="SAMPLE_FILE"/>
				<input name="OUTPUT_PATH_1" value="$V{SAMPLE_FILE}"/>
				<input name="MAP_CHANNEL_STRING" value="0,0,1,1,1,2,3,3"/>
			</operation>
        </sequence>

		<!-- Run neuron separation on prealigned data -->
        <include name="Prealigned Neuron Separation" process="MCFOSeparationPipeline">
            <input name="SAMPLE_ENTITY_ID"/>
            <input name="SAMPLE_FILE"/>
            <input name="INPUT_FILENAME" value="$V{SAMPLE_FILE}"/>
            <input name="RESULT_ENTITY_NAME" value="Two Channel Neuron Separation"/>
        </include>
	    	     
    </sequence>
</process>