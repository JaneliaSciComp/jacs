<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE hibernate-mapping PUBLIC
    "-//Hibernate/Hibernate Mapping DTD 3.0//EN"
    "http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd">
<hibernate-mapping package="org.janelia.it.jacs.model.user_data">
    <class name="org.janelia.it.jacs.model.user_data.Subject" table="subject" lazy="true">

        <id name="id" access="field" column="id" type="java.lang.Long">
            <generator class="org.janelia.it.jacs.model.TimebasedIdentifierGenerator" />
        </id>
	
		<discriminator column="discriminator" type="java.lang.String"/>

        <property name="key" unique="true" not-null="true"
            column="subject_key" type="java.lang.String"/>
            
        <property name="name" unique="true" not-null="true"
            column="name" type="java.lang.String"/>

        <property name="fullName" type="java.lang.String"/>
	
        <property name="email" type="java.lang.String"/>

        <set name="nodes" cascade="all" inverse="true" lazy="true">
            <key foreign-key="node_fk_user">
               <column name="user_id" index="node_fk_user"/>
            </key>
            <one-to-many class="Node" />
        </set>

        <set name="tasks" cascade="all" lazy="true">
            <key foreign-key="task_fk_user">
                <column name="user_id" index="task_fk_user"/>
            </key>                 
            <one-to-many class="org.janelia.it.jacs.model.tasks.Task" />
        </set>

        <map
            name="preferenceMap" table="subject_preference_map" 
            lazy="true" inverse="false" cascade="all" sort="unsorted">
            <key column="user_id"/>
            <index column="category_and_name" type="java.lang.String"/>
            <composite-element class="org.janelia.it.jacs.model.user_data.prefs.SubjectPreference">
                <property name="name" type="java.lang.String"/>
                <property name="category" type="java.lang.String"/>
                <property name="value" type="java.lang.String"/>
            </composite-element>
        </map>
        
		<subclass name="Group" discriminator-value="group" lazy="true">
		
	        <set name="userRelationships" cascade="all,delete-orphan" inverse="true" lazy="true" table="subject_relationship">
	            <key column="group_subject_id"/>
	            <one-to-many class="SubjectRelationship"/>
	        </set>
	        
		</subclass>
		
		<subclass name="User" discriminator-value="user" lazy="true">
	
	        <set name="groupRelationships" cascade="all,delete-orphan" lazy="true" table="subject_relationship">
	            <key column="user_subject_id"/>
	            <one-to-many class="SubjectRelationship"/>
	        </set>
	    
		</subclass>

	</class>

</hibernate-mapping>